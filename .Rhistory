install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("manlius/muxViz")
remove.packages("muxViz")
devtools::install_github("manlius/muxViz")
library(htmltools)
library(htmltools)
install.packages("htmltools")
detach("package:htmltools", unload = TRUE)
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
library(emln)#multilayer package
sp_list<-read.csv("Data/species_list.csv")
library(bipartite)
library(vegan)
library(sna)
library(tidyverse)
setwd("D:/Trabajo/Papers/Norwood_Farm/norwood-ecosystem-services-main_Tinio")
sp_list<-read.csv("Data/species_list.csv")
View(sp_list)
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
filter(taxon != "Crop") %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower)
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
filter(taxon != "Crop") %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower)
View(sp_list)
View(sp_list)
View(species_list)
Norwood_farm$nodes
View(species_list)
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower)
View(species_list)
View(species_list)
aphid.par.repo<-readLines("Data/biomass_repositories/bodysizes_2008.txt") #read multilayer object
aphid.par.repo<-readLines("Data/biomass_repositories/bodysizes_2008.txt") %>%
as.matrix()
View(aphid.par.repo)
aphid.par.repo<-readLines("Data/biomass_repositories/bodysizes_2008.txt", sep =",") %>%
as.matrix()
View(aphid.par.repo)
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt", header = TRUE, sep = ",") # You may need to adjust separator and other arguments based on your file format
View(aphid.par.repo)
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt", sep = "") # You may need to adjust separator and other arguments based on your file format
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt", sep = ",") # You may need to adjust separator and other arguments based on your file format
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt") # You may need to adjust separator and other arguments based on your file format
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt", header = TRUE) # You may need to adjust separator and other arguments based on your file format
View(aphid.par.repo)
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt", header = TRUE,
"\t") # You may need to adjust separator and other arguments based on your file format
aphid.par.repo<-read.table("Data/biomass_repositories/bodysizes_2008.txt") # You may need to adjust separator and other arguments based on your file format
aphid.par.repo.<-read.table("Data/biomass_repositories/bodysizes_2008.txt") # You may need to adjust separator and other arguments based on your file format
aphid.par.repo<-read.delim("Data/biomass_repositories/bodysizes_2008.txt") # You may need to adjust separator and other arguments based on your file format
View(aphid.par.repo)
View(species_list)
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%node_name)
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name)
View(filter_sps)
View(filter_sps)
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name |
Taxonomy.resource%in%species_list$node_name)
View(filter_sps)
Sialis.fuliginosa<- species_list %>% filter(node_name == "Sialis fuliginosa")
View(Sialis.fuliginosa)
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name |
Taxonomy.resource%in%species_list$node_name) %>%
select(Taxonomy.consumer,Mean.mass..g..consumer,Taxonomy.resource,
Mean.mass..g..resource)
View(filter_sps)
View(filter_sps)
#split upper and lower to create a list
upper<- filter_sps[,1:2]
View(upper)
lower<-filter_sps[,3:4]
View(lower)
aphid.par.bio<-rbind(upper,lower)
View(species_list)
#split upper and lower to create a list
upper<- filter_sps[,1:2] %>% rename("node_name" = "Taxonomy.consumer", "biomass.g" ="Mean.mass..g..consumer")
lower<-filter_sps[,3:4] %>% rename("node_name" = "Taxonomy.resource", "biomass.g" ="Mean.mass..g..resource")
aphid.par.bio<-rbind(upper,lower)
View(aphid.par.bio)
View(filter_sps)
#Split consumer and resource information
upper<- filter_sps[,1:2] %>% rename("node_name" = "Taxonomy.consumer", "biomass.g" ="Mean.mass..g..consumer")
lower<-filter_sps[,3:4] %>% rename("node_name" = "Taxonomy.resource", "biomass.g" ="Mean.mass..g..resource")
aphid.par.bio<-rbind(upper,lower) %>% gsub("\\s*\\([^\\)]+\\)", "", node_name)
aphid.par.bio<-rbind(upper,lower) %>% gsub("\\s*\\([^\\)]+\\)", "", "node_name")
View(aphid.par.bio)
View(aphid.par.bio)
aphid.par.bio<-rbind(upper,lower) %>% gsub("([^\\)])", "", "node_name")
aphid.par.bio<-rbind(upper,lower) %>% gsub("\\s*\\([^\\)]+\\)", "", node_name)
aphid.par.bio2<- aphid.par.bio %>% gsub("\\s*\\([^\\)]+\\)", "", node_name)
aphid.par.bio2<- aphid.par.bio %>% gsub("\\s*\\([^\\)]+\\)", "", aphid.par.bio$node_name)
aphid.par.bio2<- aphid.par.bio %>% lapply(node_name, function(x) gsub("\\s*\\([^\\)]+\\)", "", node_name))
aphid.par.bio2<- aphid.par.bio %>% lapply(node_name, function(node_name) gsub("\\s*\\([^\\)]+\\)", "", node_name))
aphid.par.bio<-rbind(upper,lower) %>% mutate(node_name = gsub("\\s*\\([^\\)]+\\)", "", node_name))
View(aphid.par.bio)
View(species_list)
keep_first_two_words <- function(text) {
words <- str_split(text, "\\s+")[[1]]
paste(words[1:2], collapse = " ")
}
aphid.par.bio<-rbind(upper,lower)
keep_first_two_words <- function(text) {
words <- str_split(text, "\\s+")[[1]]
paste(words[1:2], collapse = " ")
}
aphid.par.bio<-rbind(upper,lower) %>% sapply(node_name, keep_first_two_words)
#Split consumer and resource information
upper<- filter_sps[,1:2] %>% rename("node_name" = "Taxonomy.consumer", "biomass.g" ="Mean.mass..g..consumer")
lower<-filter_sps[,3:4] %>% rename("node_name" = "Taxonomy.resource", "biomass.g" ="Mean.mass..g..resource")
aphid.par.bio<-rbind(upper,lower) %>% sapply(node_name, keep_first_two_words)
aphid.par.bio<-rbind(upper,lower) %>% mutate( node_name = sapply(node_name, keep_first_two_words))
View(aphid.par.bio)
aphid.par.bio<-rbind(upper,lower) %>% mutate( node_name = sapply(node_name, keep_first_two_words)) %>%
mutate(node_name = gsub("\\bNA\\b", "", node_name))
View(aphid.par.bio)
#check for those species in the repository that match in our dataframe
biomass.aphid.par<- species_list %>% left_join(aphid.par.bio, by = node_name)
#check for those species in the repository that match in our dataframe
biomass.aphid.par<- species_list %>% left_join(aphid.par.bio, by = "node_name")
View(aphid.par.bio)
aphid.par.repo<-read.delim("Data/biomass_repositories/bodysizes_2008.txt")
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name |
Taxonomy.resource%in%species_list$node_name) %>%
select(Taxonomy.consumer,Mean.mass..g..consumer,Taxonomy.resource,
Mean.mass..g..resource) %>%  #filter sps from the database
unique() #the biomass is already averaged
#Split consumer and resource information
upper<- filter_sps[,1:2] %>% rename("node_name" = "Taxonomy.consumer", "biomass.g" ="Mean.mass..g..consumer")
lower<-filter_sps[,3:4] %>% rename("node_name" = "Taxonomy.resource", "biomass.g" ="Mean.mass..g..resource")
aphid.par.bio<-rbind(upper,lower)
#function to keep the first two words in species name from the repository
keep_first_two_words <- function(text) {
words <- str_split(text, "\\s+")[[1]]
paste(words[1:2], collapse = " ")
}
#apply function
aphid.par.bio<-rbind(upper,lower) %>% mutate( node_name = sapply(node_name, keep_first_two_words)) %>%
mutate(node_name = gsub("\\bNA\\b", "", node_name)) #eliminate extra text in some columns
#check for those species in the repository that match in our dataframe
biomass.aphid.par<- species_list %>% left_join(aphid.par.bio, by = "node_name")
View(biomass.aphid.par)
#check for those species in the repository that match in our dataframe
biomass.aphid.par<- species_list %>% left_join(aphid.par.bio, by = "node_name") %>% unique()
View(aphid.par.bio)
View(biomass.aphid.par)
aphid.par.repo<-read.delim("Data/biomass_repositories/bodysizes_2008.txt")
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name |
Taxonomy.resource%in%species_list$node_name) %>%
select(Taxonomy.consumer,Mean.mass..g..consumer,Taxonomy.resource,
Mean.mass..g..resource) %>%  #filter sps from the database
unique() #the biomass is already averaged
View(filter_sps)
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name |
Taxonomy.resource%in%species_list$node_name)
View(filter_sps)
library(bipartite)
library(vegan)
library(sna)
library(tidyverse)
setwd("D:/Trabajo/Papers/Norwood_Farm/norwood-ecosystem-services-main_Tinio")
### Upload list of nodes
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
### Create list of species
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower)
View(species_list)
### Create list of species
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub("\\?", "", node_name))
View(species_list)
### Create list of species
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub(c("\\?","1","zCROP"), "", node_name))
### Create list of species
pattern<-c("\\?","1","zCROP")
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub(c("\\?","1","zCROP"), "", node_name))
### Create list of species
pattern<-c("\\?","1","zCROP")
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name = str_replace_all(node_name, pattern, ""))
### Upload list of nodes
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
### Create list of species
pattern<-c("\\?","1","zCROP")
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate(node_name = reduce(pattern, ~str_replace(.x, .y, "")))
View(species_list)
### Upload list of nodes
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
### Create list of species
pattern<-c("\\?","1","zCROP")
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate(node_name = reduce(pattern, ~str_replace(.x, .y, "")))
View(species_list)
### Upload list of nodes
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
### Create list of species
pattern<-c("\\?","1","zCROP")
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name = str_replace_all(node_name, pattern, ""))
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub(c("\\?","1","zCROP"), "", node_name))
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub(c("\\?"), "", node_name)) %>%
mutate (node_name =  gsub(c("1"), "", node_name)) %>% mutate (node_name =  gsub(c("zCROP"), "", node_name))
View(species_list)
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub(c("\\?"), "", node_name)) %>%
mutate (node_name =  gsub(c("1"), "", node_name)) %>%
mutate (node_name =  gsub(c("zCROP"), "", node_name)) #keep just the species name of most rows
birds.repo<-read.delim("Data/biomass_repositories/BirdFuncDat.txt")
View(birds.repo)
prueba<-birds.repo %>% select(Scientific,BodyMass.Value) %>%
filter(Scientific == "Grey Woodpecker")
View(prueba)
prueba<-birds.repo %>% select(Scientific,BodyMass.Value) %>%
filter(Scientific == "Mesopicos goertae")
View(prueba)
prueba<-birds.repo %>% select(Scientific,BodyMass.Value) %>% group_by(Scientific,BodyMass.Value) %>%
n()
prueba<-birds.repo %>% select(Scientific,BodyMass.Value) %>% group_by(Scientific,BodyMass.Value) %>%
count()
View(prueba)
mam.repo<-read.delim("Data/biomass_repositories/MamFuncDat.txt")
View(mam.repo)
