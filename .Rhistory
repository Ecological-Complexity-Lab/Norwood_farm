install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("manlius/muxViz")
remove.packages("muxViz")
devtools::install_github("manlius/muxViz")
library(htmltools)
library(htmltools)
install.packages("htmltools")
detach("package:htmltools", unload = TRUE)
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
library(emln)#multilayer package
library(bipartite)
library(vegan)
library(sna)
library(tidyverse)
library(readxl)
setwd("D:/Trabajo/Papers/Norwood_Farm/norwood-ecosystem-services-main_Tinio")
### Upload list of nodes
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
### Create list of species
species_list<-Norwood_farm$nodes %>% select(node_id,node_name,taxon) %>%
separate(node_name, c("trophic_lower", "node_name"),  "[A-Z]\\.") %>%
select(-trophic_lower) %>% mutate (node_name =  gsub(c("\\?"), "", node_name)) %>%
mutate (node_name =  gsub(c("1"), "", node_name)) %>%
mutate (node_name =  gsub(c("zCROP"), "", node_name)) %>%
mutate (node_name = gsub("\\.", " ", node_name))#keep just the species name of most rows
#birds
birds.repo<-read.delim("Data/biomass_repositories/BirdFuncDat.txt") %>%
select(Scientific,BodyMass.Value) %>% rename("node_name" = "Scientific",
"Mass" = "BodyMass.Value")
#check for those species in the repository that match in our dataframe
mass.birds<- species_list %>% left_join(birds.repo, by = "node_name") %>%
filter(taxon =="Seed-feeding bird")
# mammals
mam.repo<-read.delim("Data/biomass_repositories/MamFuncDat.txt")%>%
select(Scientific,BodyMass.Value) %>% rename("node_name" = "Scientific",
"Mass" = "BodyMass.Value")
#check for those species in the repository that match in our dataframe
mass.mam<- species_list %>% left_join(mam.repo, by = "node_name") %>%
filter(taxon =="Seed-feeding rodent")
aphid.par.repo<-read.delim("Data/biomass_repositories/bodysizes_2008.txt")
filter_sps<-aphid.par.repo %>% filter(Taxonomy.consumer%in%species_list$node_name |
Taxonomy.resource%in%species_list$node_name) %>%
select(Taxonomy.consumer,Mean.mass..g..consumer,Taxonomy.resource,
Mean.mass..g..resource) %>%  #filter sps from the database
unique() #the biomass is already averaged
#Split consumer and resource information
upper<- filter_sps[,1:2] %>% rename("node_name" = "Taxonomy.consumer", "biomass.g" ="Mean.mass..g..consumer")
lower<-filter_sps[,3:4] %>% rename("node_name" = "Taxonomy.resource", "biomass.g" ="Mean.mass..g..resource")
#function to keep the first two words in species name from the repository
keep_first_two_words <- function(text) {
words <- str_split(text, "\\s+")[[1]]
paste(words[1:2], collapse = " ")
}
#apply function
aphid.par.bio<-rbind(upper,lower) %>% unique() %>%
filter(biomass.g >0) %>% #eliminate species with - biomass (error in dataframe)
mutate( node_name = sapply(node_name, keep_first_two_words)) %>%
mutate(node_name = gsub("\\bNA\\b", "", node_name)) #eliminate extra text in some columns
#add data of biomass manually and do the average for the rest
mass.aphid<- species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>%  mutate (biomass.g = case_when(node_name == "Acyrthosiphon pisum"~ 0.0008623,
node_name == "Myzus persicae"~ 0.0002042,
node_name == "Sitobion avenae"~ 0.0031632,
TRUE~biomass.g)) %>%
filter(taxon == "Aphid") %>% mutate(biomass.g =if_else(is.na(biomass.g),
mean(biomass.g, na.rm = TRUE), biomass.g))
#add data of biomass manually and do the average for the rest
mass.1.par<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Primary aphid parasitoid") %>%
mutate (biomass.g = case_when(node_name == "Aphidius rhopalosiphi"~ 0.000161,
TRUE~biomass.g)) #%>% #add manually more data
mass.2.par<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Secondary aphid parasitoid")  #%>%
mass.ins.par<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Insect seed-feeder parasitoid") %>%
mutate (biomass.g = case_when(node_name == "Pteromalus albipennis"~ 0.0013,
node_name == "Mesopolobus incultus"~ 0.00045,
node_name == "Pteromalus elevatus"~ 0.0121,
TRUE~biomass.g)) #%>% #add manually more data
mass.seed.ins<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Seed-feeding insect ") # %>%
View(mass.seed.ins)
View(aphid.par.bio)
View(species_list)
mass.seed.ins<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Seed-feeding insect") # %>%
View(mass.seed.ins)
mass.seed.ins<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Seed-feeding insect") # %>%
mass.seed.ins<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Seed-feeding insect")  %>%
mutate (biomass.g = case_when(node_name == "Bruchidius varius"~ 0.003,
node_name == "Olibrus aeneus"~ 0.000251,
node_name == "Rhinocyllus conicus"~ 0.00845,
node_name == "Sitona lineatus"~ 0.00165,
node_name == "Urophora stylata"~ 0.0041,
TRUE~biomass.g)) #%>% #add manually more data
View(mass.seed.ins)
mass.seed.ins<-species_list %>% left_join(aphid.par.bio, by = "node_name") %>%
unique() %>% filter(taxon == "Seed-feeding insect")  %>%
mutate (biomass.g = case_when(node_name == "Bruchidius varius"~ 0.003,
node_name == "Olibrus aeneus"~ 0.000251,
node_name == "Rhinocyllus conicus"~ 0.00845,
node_name == "Sitona lineatus"~ 0.00165,
node_name == "Urophora stylata"~ 0.0041,
TRUE~biomass.g)) %>% #add manually more data
mutate(biomass.g =if_else(is.na(biomass.g),
mean(biomass.g, na.rm = TRUE), biomass.g)) #do the average for the rest
View(species_list)
