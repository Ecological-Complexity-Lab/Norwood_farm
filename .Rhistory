install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("manlius/muxViz")
remove.packages("muxViz")
devtools::install_github("manlius/muxViz")
library(htmltools)
library(htmltools)
install.packages("htmltools")
detach("package:htmltools", unload = TRUE)
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
library(emln)#multilayer package
#load packages
library(igraph)
library(dplyr)
library(tidyverse)
library(emln)#multilayer package
library(readr)
library(ggplot2)
library(cowplot)
setwd("/Users/agustin/Desktop/Papers/Norwood_farm/Norwood_Tinio")
######### --- Upload multilayer network
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
#amount Bird and butterfly watching
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(log(abun)))
#direct
direct_ES<- read.csv("Data/Land_use_dir_weighted_CP_intense.csv", sep =",")
direct_ES$management <- factor(direct_ES$management, levels = c("E", "SE", "M", "SI","I","IM")) #change order of factors
#amount Bird and butterfly watching
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(log(abun)))
Prop_weight_watching<-  direct_ES %>% group_by(management,services) %>%
filter (services == "Bird watching" | services == "Butterfly watching") %>%
summarize(tot= sum(log(abun)))%>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Bird watching"~ 35.76123,
services == "Butterfly watching"~ 74.63351),
ratio_change = tot / Extensive_tot)
View(tot_services_emp_watching)
Prop_weight_watching<-  direct_ES %>% group_by(management,services) %>%
filter (services == "Bird watching" | services == "Butterfly watching") %>%
summarize(tot= sum(log(abun)))%>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Bird watching"~ 35.76123,
services == "Butterfly watching"~ 74.63351),
ratio_change = tot / Extensive_tot)
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" ))
View(tot_services_emp_watching)
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(log(abun)))
View(tot_services_emp_watching)
Prop_weight_watching<-  direct_ES %>% group_by(management,services) %>%
filter (services == "Bird watching" | services == "Butterfly watching") %>%
summarize(tot= sum(log(abun)))%>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Bird watching"~ 35.76123,
services == "Butterfly watching"~ 74.63351),
ratio_change = tot / Extensive_tot)
#amount Bird and butterfly watching
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = log(sum(abun)))
Prop_weight_watching<-  direct_ES %>% group_by(management,services) %>%
filter (services == "Bird watching" | services == "Butterfly watching") %>%
summarize(tot= log(sum(abun)))%>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Bird watching"~ 7.638198,
services == "Butterfly watching"~ 8.839711),
ratio_change = tot / Extensive_tot)
View(Prop_weight_watching)
#amount the rest ESs
tot_services_emp_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(tot_empirical = abun * body_mass) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = log(sum(tot_empirical)))
View(tot_services_emp_rest)
#amount the rest ESs
tot_services_emp_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(tot_empirical = abun * body_mass) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = log(sum(tot_empirical)))
#amount the rest ESs
tot_services_emp_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(tot_empirical = abun * body_mass) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = log(sum(tot_empirical)))
Prop_weight_rest<-  direct_ES %>% group_by(management,services) %>%
filter (!(services == "Bird watching" | services == "Butterfly watching")) %>%
mutate(tot_sim = abun * body_mass) %>%
summarize(tot= log(sum(tot_sim))) %>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Crop damage"~ 13.475062,
services == "Crop production"~ 12.251524,
services == "Pest control"~ -8.869021,
services == "Pollination"~ -10.511533,
services == "Seed dispersal"~ 12.799945),
ratio_change = tot / Extensive_tot)
#merge the data
Prop_amount<- rbind(Prop_weight_watching,Prop_weight_rest)
#Plot
prop_amount2<- Prop_amount %>% ggplot(aes(x = management, y = ratio_change)) +
geom_boxplot(color = "black") +
geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0.5),
pch=21, aes(fill=factor(services)), size = 3.5, show.legend = T) +
scale_fill_manual(values = color_services$color, name = "E(D)S") +
scale_y_continuous(name = "Relative change in the amount of direct E(D)S provided") +
scale_x_discrete(name = "Habitat conversion")+
theme(panel.background = element_rect(fill = "white"),
panel.grid.major=element_line(color = "gray"),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text.y = element_text(size=13, color='black'),
axis.text = element_text(size=15, color='black'),
axis.text.x= element_text(size =14),
axis.title = element_text(size=17, color='black'),
axis.line = element_blank(),
legend.text.align = 0,
legend.title =  element_text(size = 14, color = "black"),
legend.text = element_text(size = 12))
color_services <-tibble(
services = unique(direct_ES$services),
color = c('#1b9e77','#d95f02','#7570b3','#e7298a','#2c7fb8','#e6ab02','#a6761d'))
#Plot
prop_amount2<- Prop_amount %>% ggplot(aes(x = management, y = ratio_change)) +
geom_boxplot(color = "black") +
geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0.5),
pch=21, aes(fill=factor(services)), size = 3.5, show.legend = T) +
scale_fill_manual(values = color_services$color, name = "E(D)S") +
scale_y_continuous(name = "Relative change in the amount of direct E(D)S provided") +
scale_x_discrete(name = "Habitat conversion")+
theme(panel.background = element_rect(fill = "white"),
panel.grid.major=element_line(color = "gray"),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text.y = element_text(size=13, color='black'),
axis.text = element_text(size=15, color='black'),
axis.text.x= element_text(size =14),
axis.title = element_text(size=17, color='black'),
axis.line = element_blank(),
legend.text.align = 0,
legend.title =  element_text(size = 14, color = "black"),
legend.text = element_text(size = 12))
prop_amount2
#amount Bird and butterfly watching
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = log(sum(abun)))
#amount Bird and butterfly watching
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(log(abun)))
View(tot_services_emp_watching)
Prop_weight_watching<-  direct_ES %>% group_by(management,services) %>%
filter (services == "Bird watching" | services == "Butterfly watching") %>%
summarize(tot= sum(log(abun)))%>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Bird watching"~ 35.76123,
services == "Butterfly watching"~ 74.63351),
ratio_change = tot / Extensive_tot)
#amount the rest ESs
tot_services_emp_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(tot_empirical = log(abun * body_mass) )%>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(tot_empirical))
#amount the rest ESs
tot_services_emp_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(tot_empirical = log(abun * body_mass) )%>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(tot_empirical))
Prop_weight_rest<-  direct_ES %>% group_by(management,services) %>%
filter (!(services == "Bird watching" | services == "Butterfly watching")) %>%
mutate(tot_sim = log(abun * body_mass)) %>%
summarize(tot= sum(tot_sim)) %>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Crop damage"~ 136.28659,
services == "Crop production"~ 56.83402,
services == "Pest control"~ 38.31157,
services == "Pollination"~ 275.83126,
services == "Seed dispersal"~ 50.14356),
ratio_change = tot / Extensive_tot)
#merge the data
Prop_amount<- rbind(Prop_weight_watching,Prop_weight_rest)
#Plot
prop_amount2<- Prop_amount %>% ggplot(aes(x = management, y = ratio_change)) +
geom_boxplot(color = "black") +
geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0.5),
pch=21, aes(fill=factor(services)), size = 3.5, show.legend = T) +
scale_fill_manual(values = color_services$color, name = "E(D)S") +
scale_y_continuous(name = "Relative change in the amount of direct E(D)S provided") +
scale_x_discrete(name = "Habitat conversion")+
theme(panel.background = element_rect(fill = "white"),
panel.grid.major=element_line(color = "gray"),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text.y = element_text(size=13, color='black'),
axis.text = element_text(size=15, color='black'),
axis.text.x= element_text(size =14),
axis.title = element_text(size=17, color='black'),
axis.line = element_blank(),
legend.text.align = 0,
legend.title =  element_text(size = 14, color = "black"),
legend.text = element_text(size = 12))
prop_amount2
#upload and prepare dataframe
direct_ES<- read.csv("Data/Land_use_dir_weighted_CP_intense.csv", sep =",")
direct_ES$management <- factor(direct_ES$management, levels = c("E", "SE", "M", "SI","I","IM")) #change order of factors
Prop_dir<-direct_ES %>% group_by(management,services) %>%
mutate(tot = n()) %>% ungroup() %>%
group_by(services) %>%
mutate(prop = tot/max(tot)) %>%  #prop of E(D)S rtained across habitat management
dplyr::select(management,services,tot,prop) %>%
unique()
# adjust the extreme values according to the beta conditions
Prop_dir$prop <- ifelse(Prop_dir$prop == 0, 0.000001,
ifelse(Prop_dir$prop == 1, 0.9999999, Prop_dir$prop))
# Model
library("glmmTMB")
library("stats4")
library("bbmle")
library(emmeans)
library(effects)
library(car)
Prop_dire<- glmmTMB (prop ~ management + services, family=beta_family(link="logit"), data = Prop_dir) # model that best fit
#Prop_dire2<-glmmTMB (prop ~ management + ( 1| services), family=beta_family(link="logit"), data = Prop_dir)
Anova(Prop_dire)
# Summarize the model to view coefficients
summ<-summary(Prop_dire)
View(summ)
View(Prop_dir)
