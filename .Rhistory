install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("manlius/muxViz")
remove.packages("muxViz")
devtools::install_github("manlius/muxViz")
library(htmltools)
library(htmltools)
install.packages("htmltools")
detach("package:htmltools", unload = TRUE)
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
library(emln)#multilayer package
library(emln)#multilayer package
library(readr)
library(ggplot2)
library(cowplot)
setwd("D:/Trabajo/Papers/Norwood_Farm/norwood-ecosystem-services-main_Tinio")
######### --- Upload multilayer network
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
### Add the abundances (as state nodes attributes)
abundances<-read.csv("Data/species_abundances.csv",header=T) #call abundances
state_nodes_ab<-Norwood_farm$state_nodes %>% left_join(abundances,
by = c("layer_name" = "habitat",
"node_name" = "species_name")) %>% #add abundances
left_join(Norwood_farm$nodes, by = "node_id") %>%
select(layer_id,node_id,abundance, taxon) ##add taxon
extensive_edgelist<- Norwood_farm$extended_ids %>%
select(-layer_to) %>% rename("habitat" = "layer_from") %>%
mutate(management = "E") %>% select(-habitat,-weight) %>% unique() #aggregate network
# estimate relative abundances of species in the aggregated network
ab_ext<-state_nodes_ab %>% select(-layer_id) %>% group_by(node_id,taxon) %>%
mutate(abun = sum(abundance)) %>% distinct(abun) %>% group_by(taxon) %>%
mutate(tot_ab_taxon = sum(abun)) %>% #total abundance per taxon
group_by(node_id) %>%
mutate(rel_ab=abun/tot_ab_taxon)#relative abundance per sp
# incorporate rel abundances to the edge list and calculate the weight (Product of relative abundances)
ext_edgelist_aggr<- extensive_edgelist %>% left_join(ab_ext, by = c("node_from" = "node_id")) %>%
left_join(ab_ext, by = c("node_to" = "node_id")) %>%
rename ("rel_ab_from" = "rel_ab.x", "rel_ab_to" = "rel_ab.y") %>%
mutate(weight = rel_ab_from * rel_ab_to) %>% #calculate weight
select(node_from,node_to,weight,management)
#### Check for specis that provide pest control
crops = 94:99
#### Check for specis that provide pest control
crops = 94:99
aphid = 341:368
seed_ins = 480:498
seed_bird = 499:510
seed_rod = 511:514
butt = 515:530
flow_vis = 100:340
flow_vis_crop<- ext_edgelist_aggr %>% filter(node_to %in%flow_vis & node_from %in%crops)
butt_crop<- ext_edgelist_aggr %>% filter(node_to %in%butt & node_from %in%crops)
View(flow_vis_crop)
