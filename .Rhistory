install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
devtools::install_github("manlius/muxViz")
remove.packages("muxViz")
devtools::install_github("manlius/muxViz")
library(htmltools)
library(htmltools)
install.packages("htmltools")
detach("package:htmltools", unload = TRUE)
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
install.packages("htmltools")
devtools::install_github("manlius/muxViz")
library(emln)#multilayer package
#load packages
library(igraph)
library(dplyr)
library(tidyverse)
library(emln)#multilayer package
library(readr)
library(ggplot2)
library(cowplot)
setwd("/Users/agustin/Desktop/Papers/Norwood_farm/Norwood_Tinio")
######### --- Upload multilayer network
Norwood_farm<-readRDS("Data/Norwood_farm.RData") #read multilayer object
#direct
direct_ES<- read.csv("Data/Land_use_dir_weighted_CP_intense.csv", sep =",")
direct_ES$management <- factor(direct_ES$management, levels = c("E", "SE", "M", "SI","I","IM")) #change order of factors
color_services <-tibble(
services = unique(direct_ES$services),
color = c('#1b9e77','#d95f02','#7570b3','#e7298a','#2c7fb8','#e6ab02','#a6761d'))
Prop_weight<-direct_ES %>% filter(management=="I", taxon == "Flower-visiting") %>% select(management, node_id,weight) %>%
group_by(management,node_id) %>% left_join(tot_services_emp[,2:3], by = "node_id") %>%
mutate(ratio = weight/tot_empirical) %>% arrange(desc(ratio)) %>%
left_join(Norwood_farm$nodes [,1:2], by = "node_id") ##add names
#LOG just biomass  (SUPPLEMENTARY IF THEY ASK)
#amount Bird and butterfly watching
tot_services_emp_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(abun))
Prop_weight_watching<-  direct_ES %>% group_by(management,services) %>%
filter (services == "Bird watching" | services == "Butterfly watching") %>%
summarize(tot= sum(abun))%>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Bird watching"~ 2076,
services == "Butterfly watching"~ 6903),
ratio_change = tot / Extensive_tot)
#amount the rest ESs
tot_services_emp_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(tot_empirical = abun * log(body_mass))%>%
group_by(management,services) %>%
summarize(tot_empirical_amount = sum(tot_empirical))
Prop_weight_rest<-  direct_ES %>% group_by(management,services) %>%
filter (!(services == "Bird watching" | services == "Butterfly watching")) %>%
mutate(tot_sim = abun * log(body_mass)) %>%
summarize(tot= sum(tot_sim)) %>% ungroup() %>%
mutate(Extensive_tot = case_when(
services == "Crop damage"~ -2.319425e+08,
services == "Crop production"~ 3.087185e+03,
services == "Pest control"~ -2.972469e+07,
services == "Pollination"~ -4.740863e+05,
services == "Seed dispersal"~ 5.686070e+03),
ratio_change = tot / Extensive_tot)
#merge the data
Prop_amount<- rbind(Prop_weight_watching,Prop_weight_rest)
#Plot
prop_amount2<- Prop_amount %>% ggplot(aes(x = management, y = ratio_change)) +
geom_boxplot(color = "black") +
geom_point(position=position_jitterdodge(jitter.width=2, dodge.width = 0.5),
pch=21, aes(fill=factor(services)), size = 3.5, show.legend = T) +
scale_fill_manual(values = color_services$color, name = "E(D)S") +
scale_y_continuous(name = "Relative change in the amount of direct E(D)S provided") +
scale_x_discrete(name = "Habitat conversion")+
theme(panel.background = element_rect(fill = "white"),
panel.grid.major=element_line(color = "gray"),
panel.border = element_rect(color = "black",fill = NA,size = 1),
panel.spacing = unit(0.5, "cm", data = NULL),
axis.text.y = element_text(size=13, color='black'),
axis.text = element_text(size=15, color='black'),
axis.text.x= element_text(size =14),
axis.title = element_text(size=17, color='black'),
axis.line = element_blank(),
legend.text.align = 0,
legend.title =  element_text(size = 14, color = "black"),
legend.text = element_text(size = 12))
prop_amount2
## Amount Bird and butterfly watching
extensive_amount_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
select(node_id, services, abun)
# Merging with other management scenarios and calculate ratio of change
dir_amount_watching <- direct_ES %>% filter(services == "Bird watching" | services == "Butterfly watching" ) %>%
left_join(extensive_amount_watching, by = c("node_id", "services"), suffix = c("", "_extensive")) %>%
mutate(ratio_change = abun / abun_extensive) %>% #ratio of change: values higher than 1 indicates increasing in the amount of E(D)S
select(management,node_id,services,ratio_change)
## Amount if the rest ESs
extensive_amount_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
mutate(Extensive_tot = abun * log(body_mass)) %>%
select(node_id, services, Extensive_tot)
dir_amount_rest<-direct_ES %>% filter(!(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" ))) %>%
mutate(tot_empirical = abun * log(body_mass)) %>%
left_join(extensive_amount_rest, by = c("node_id", "services"), suffix = c("", "_extensive")) %>%
mutate(ratio_change = tot_empirical / Extensive_tot) %>%  #ratio of change: values higher than 1 indicates increasing in the amount of E(D)S
select(management,node_id,services,ratio_change)
dir_amount<- rbind(dir_amount_watching,dir_amount_rest)
#model
m_amount2<- glmmTMB(ratio_change ~ management+services + (1|node_id),family = Gamma(link = "log"),
data = dir_amount) #the lowest AIC, interaction did not converge
# Model
library(glmmTMB)
#model
m_amount2<- glmmTMB(ratio_change ~ management+services + (1|node_id),family = Gamma(link = "log"),
data = dir_amount) #the lowest AIC, interaction did not converge
Anova(m_amount2)
# Model
library("glmmTMB")
library("stats4")
library("bbmle")
#model
m_amount2<- glmmTMB(ratio_change ~ management+services + (1|node_id),family = Gamma(link = "log"),
data = dir_amount) #the lowest AIC, interaction did not converge
Anova(m_amount2)
Anova(m_amount)
# Summarize the model to view coefficients
summ<-summary(m_amount2)
summ
anova(m_amount2)
# Model
library("glmmTMB")
library("stats4")
library("bbmle")
library(emmeans)
library(effects)
library(car)
#model
m_amount2<- glmmTMB(ratio_change ~ management+services + (1|node_id),family = Gamma(link = "log"),
data = dir_amount) #the lowest AIC, interaction did not converge
Anova(m_amount2)
# Summarize the model to view coefficients
summ<-summary(m_amount2)
View(summ)
# Summarize the model to view coefficients
summ<-summary(m_amount2)
# Extract the coefficients (for GLMM It's the average including all the levels)
coefficients <- summ$coefficients$cond
# Extract coefficients for each factor
management_coefs <- coefficients[grep("management", rownames(coefficients)), "Estimate"]
services_coefs <- coefficients[grep("services", rownames(coefficients)), "Estimate"]
# Calculate summary statistics (e.g., mean) for each factor
management_summary <- mean(management_coefs)
services_summary <- mean(services_coefs)
## Amount Bird and butterfly watching
extensive_amount_watching<-direct_ES %>% filter(management=="E" &  (services == "Bird watching" | services == "Butterfly watching" )) %>%
select(node_id, services, abun)
# Merging with other management scenarios and calculate ratio of change
dir_amount_watching <- direct_ES %>% filter(services == "Bird watching" | services == "Butterfly watching" ) %>%
left_join(extensive_amount_watching, by = c("node_id", "services"), suffix = c("", "_extensive")) %>%
mutate(ratio_change = abun / abun_extensive) %>% #ratio of change: values higher than 1 indicates increasing in the amount of E(D)S
select(management,node_id,services,ratio_change)
## Amount if the rest ESs
extensive_amount_rest<-direct_ES %>% filter(management=="E" &  !(services == "Bird watching" | services == "Butterfly watching" )) %>%
select(node_id, services, weight)
# Merging with other management scenarios and calculate ratio of change
dir_amount_rest <- direct_ES %>% filter(!(services == "Bird watching" | services == "Butterfly watching" )) %>%
left_join(extensive_amount_rest, by = c("node_id", "services"), suffix = c("", "_extensive")) %>%
mutate(ratio_change = weight / weight_extensive) %>%  #ratio of change: values higher than 1 indicates increasing in the amount of E(D)S
select(management,node_id,services,ratio_change)
## Final amount
dir_amount<- rbind(dir_amount_watching,dir_amount_rest)
# Model
library(glmmTMB)
m_amount<- glmmTMB(ratio_change ~ management+services + (1|node_id),family = Gamma(link = "log"),
data = dir_amount) #the lowest AIC, interaction did not converge
Anova(m_amount)
# Summarize the model to view coefficients
summ<-summary(m_amount)
# Extract the coefficients (for GLMM It's the average including all the levels)
coefficients <- summ$coefficients$cond
# Extract coefficients for each factor
management_coefs <- coefficients[grep("management", rownames(coefficients)), "Estimate"]
services_coefs <- coefficients[grep("services", rownames(coefficients)), "Estimate"]
# Calculate summary statistics (e.g., mean) for each factor
management_summary <- mean(management_coefs)
services_summary <- mean(services_coefs)
